<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Shooter: Boss Annihilation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech&display=swap');
        body { margin: 0; background: #010103; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Share Tech', sans-serif; }
        canvas { border: 1px solid #161b22; background: #020205; box-shadow: 0 0 50px rgba(0, 0, 0, 0.8); border-radius: 8px; }
        #ui { position: absolute; top: 30px; left: 30px; color: #fff; pointer-events: none; display: none; }
        #lives { font-size: 32px; filter: drop-shadow(0 0 8px #ff4d4d); margin-bottom: 5px; }
        #score-val { font-size: 28px; color: #00ffcc; text-shadow: 0 0 10px rgba(0,255,204,0.3); }
        #boss-ui { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); width: 380px; display: none; text-align: center; }
        #boss-hp-bar { width: 100%; height: 8px; background: rgba(255,0,0,0.1); border-radius: 4px; border: 1px solid rgba(255,77,77,0.4); overflow: hidden; box-shadow: 0 0 15px rgba(255,0,0,0.2); }
        #boss-hp-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0000, #9d00ff); transition: width 0.1s ease-out; }
    </style>
</head>
<body>

    <div id="ui">
        <div id="lives"></div>
        <div id="score-val">00000</div>
    </div>

    <div id="boss-ui">
        <div id="boss-title" style="color: #ff4d4d; font-size: 16px; letter-spacing: 5px; margin-bottom: 8px; font-weight: bold; text-shadow: 0 0 10px #ff0000;">STATION ANNIHILATOR DETECTED</div>
        <div id="boss-hp-bar"><div id="boss-hp-fill"></div></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiLayer = document.getElementById('ui');
        const livesDisplay = document.getElementById('lives');
        const scoreVal = document.getElementById('score-val');
        const bossUI = document.getElementById('boss-ui');
        const bossHPFill = document.getElementById('boss-hp-fill');

        canvas.width = 450;
        canvas.height = 750;

        let gameState = 'START';
        let lives, score, frameCount, bullets, enemyBullets, enemies, particles, powerUps, boss;
        let shakeTimer = 0, flashTimer = 0, nextBossScore = 1000;
        const keys = {};

        const player = { x: 200, y: 600, w: 44, h: 48, speed: 7, laserTimer: 0, shieldActive: false, shieldTimer: 0 };
        const startBtn = { x: 125, y: 400, w: 200, h: 50, isHovered: false };
        const restartBtn = { x: 125, y: 450, w: 200, h: 50, isHovered: false };
        let mouseX = 0, mouseY = 0, stars = [], asteroids = [], planets = [];

        function initBackground() {
            stars = []; asteroids = []; planets = [];
            for (let i = 0; i < 80; i++) stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 1.5, speed: Math.random() * 0.4 + 0.1 });
            planets.push({ x: 350, y: 150, size: 100, speed: 0.04, color: 'rgba(50, 30, 80, 0.2)' });
            for (let i = 0; i < 3; i++) asteroids.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: 15+Math.random()*15, speed: 0.3+Math.random()*0.4 });
        }

        function init() {
            lives = 3; score = 0; frameCount = 0; nextBossScore = 1000;
            bullets = []; enemyBullets = []; enemies = []; particles = []; powerUps = []; boss = null;
            player.x = canvas.width/2 - 22; player.y = 600;
            player.laserTimer = 0; player.shieldActive = false;
            uiLayer.style.display = 'block'; bossUI.style.display = 'none';
            gameState = 'PLAYING';
            updateUI(); initBackground();
        }

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left; mouseY = e.clientY - rect.top;
            if (gameState === 'START') startBtn.isHovered = checkBtn(startBtn);
            if (gameState === 'GAMEOVER') restartBtn.isHovered = checkBtn(restartBtn);
        });
        canvas.addEventListener('mousedown', () => {
            if (gameState === 'START' && checkBtn(startBtn)) init();
            if (gameState === 'GAMEOVER' && checkBtn(restartBtn)) init();
        });

        function checkBtn(btn) { return mouseX >= btn.x && mouseX <= btn.x + btn.w && mouseY >= btn.y && mouseY <= btn.y + btn.h; }
        function updateUI() { livesDisplay.innerHTML = '❤️'.repeat(Math.max(0, lives)); scoreVal.innerText = score.toString().padStart(5, '0'); }

        function createExplosion(x, y, color, count = 15, size = 3) {
            for (let i = 0; i < count; i++) {
                particles.push({ x, y, vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8, life: 1.0, color, size: Math.random()*size+1 });
            }
        }

        function takeDamage() {
            if (player.shieldActive) { 
                player.shieldActive = false; player.shieldTimer = 0; 
                createExplosion(player.x+22, player.y+24, '#00d2ff', 20); 
            } else { 
                lives--; updateUI(); shakeTimer = 15; flashTimer = 10; 
                createExplosion(player.x + 22, player.y + 24, '#ff4d4d', 25); 
                if (lives <= 0) { gameState = 'GAMEOVER'; uiLayer.style.display = 'none'; bossUI.style.display = 'none'; }
            }
        }

        function drawBoss(b) {
            ctx.save();
            ctx.translate(b.x + b.w/2, b.y + b.h/2);
            
            // Animasi Sayap/Bagian Samping
            let wingMover = Math.sin(frameCount * 0.05) * 10;
            
            // Body Boss
            ctx.fillStyle = '#0a0a15'; ctx.strokeStyle = b.type === 1 ? '#ff0033' : '#9d00ff';
            ctx.lineWidth = 4;
            
            // Sayap
            ctx.strokeRect(-b.w/2 - wingMover, -20, 30, 60);
            ctx.strokeRect(b.w/2 - 30 + wingMover, -20, 30, 60);
            
            // Main Frame
            ctx.beginPath();
            ctx.moveTo(-b.w/2 + 20, -b.h/2);
            ctx.lineTo(b.w/2 - 20, -b.h/2);
            ctx.lineTo(b.w/2, b.h/2);
            ctx.lineTo(-b.w/2, b.h/2);
            ctx.closePath();
            ctx.fill(); ctx.stroke();
            
            // Core bercahaya
            let glow = 5 + Math.abs(Math.sin(frameCount * 0.1) * 10);
            ctx.shadowBlur = glow; ctx.shadowColor = ctx.strokeStyle;
            ctx.fillStyle = ctx.strokeStyle;
            ctx.beginPath(); ctx.arc(0, 0, 15, 0, Math.PI*2); ctx.fill();
            
            ctx.restore();
        }

        function gameLoop() {
            ctx.save();
            if (shakeTimer > 0) { ctx.translate((Math.random()-0.5)*10, (Math.random()-0.5)*10); shakeTimer--; }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Background
            stars.forEach(s => { s.y += s.speed; if (s.y > canvas.height) s.y = 0; ctx.fillStyle = "rgba(255,255,255,0.3)"; ctx.fillRect(s.x, s.y, s.size, s.size); });
            planets.forEach(p => { p.y += p.speed; if (p.y > canvas.height + p.size) p.y = -p.size; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size/2, 0, Math.PI*2); ctx.fill(); });
            asteroids.forEach(a => { a.y += a.speed; if (a.y > canvas.height + a.size) a.y = -a.size; ctx.fillStyle = "rgba(100, 100, 100, 0.15)"; ctx.beginPath(); ctx.arc(a.x, a.y, a.size/2, 0, Math.PI*2); ctx.fill(); });

            if (gameState === 'START') {
                ctx.fillStyle = "#fff"; ctx.textAlign = "center"; ctx.font = "32px 'Share Tech'"; ctx.fillText("GALACTIC FRONTIER", canvas.width/2, 300);
                drawButton(startBtn, "START MISSION");
            } 
            else if (gameState === 'PLAYING') {
                frameCount++;
                if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
                if (keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;
                if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
                if (keys['ArrowDown'] && player.y < canvas.height - player.h) player.y += player.speed;

                if (player.laserTimer > 0) player.laserTimer--;
                if (player.shieldTimer > 0) { player.shieldTimer--; if (player.shieldTimer <= 0) player.shieldActive = false; }

                // Boss Logic
                if (!boss && score >= nextBossScore) {
                    const bossNum = nextBossScore / 1000;
                    boss = { x: 135, y: -180, w: 180, h: 100, hp: 100 + (bossNum * 150), maxHp: 100 + (bossNum * 150), speed: 1.8, dir: 1, type: (bossNum % 2 === 0 ? 2 : 1) };
                    nextBossScore += 1000; bossUI.style.display = 'block'; bossHPFill.style.width = '100%';
                }

                // Enemy & Powerup Spawning
                if (!boss && frameCount % 60 === 0) {
                    let type = (score >= 2000 && Math.random() > 0.6) ? 'zigzag' : (Math.random() > 0.8 ? 'shooter' : 'normal');
                    enemies.push({ x: Math.random()*400, y: -40, w: 40, h: 40, speed: 3, type: type, angle: 0 });
                }
                if (frameCount % 800 === 0) powerUps.push({ x: Math.random()*400, y: -30, type: Math.random() > 0.5 ? 'laser' : 'shield' });

                // Bullets
                if (frameCount % (player.laserTimer > 0 ? 6 : 12) === 0) bullets.push({ x: player.x + 22, y: player.y, w: player.laserTimer > 0 ? 35 : 4, h: 15, power: player.laserTimer > 0 ? 3 : 1 });
                bullets = bullets.filter(b => {
                    b.y -= 12; ctx.fillStyle = player.laserTimer > 0 ? '#ff3366' : '#00ffcc'; ctx.fillRect(b.x - b.w/2, b.y, b.w, b.h);
                    if (boss && b.x > boss.x && b.x < boss.x + boss.w && b.y < boss.y + boss.h) {
                        boss.hp -= b.power; bossHPFill.style.width = (boss.hp / boss.maxHp) * 100 + '%';
                        // PARTIKEL KETIKA PELURU MENGENAI BOSS
                        createExplosion(b.x, b.y, '#ffffff', 4, 1.5); 
                        createExplosion(b.x, b.y, boss.type === 1 ? '#ff0033' : '#9d00ff', 2, 2);
                        if (boss.hp <= 0) { createExplosion(boss.x + 90, boss.y + 50, '#ff0000', 50, 4); boss = null; bossUI.style.display = 'none'; score += 500; updateUI(); }
                        return false;
                    }
                    return b.y > -20;
                });

                // Boss AI & Attacks
                if (boss) {
                    if (boss.y < 80) boss.y += 2;
                    else {
                        boss.x += boss.speed * boss.dir;
                        if (boss.x < 10 || boss.x > canvas.width - boss.w - 10) boss.dir *= -1;
                        if (boss.type === 1 && frameCount % 45 === 0) enemyBullets.push({ x: boss.x + 40, y: boss.y + 90, vx: 0, vy: 6 }, { x: boss.x + 140, y: boss.y + 90, vx: 0, vy: 6 });
                        if (boss.type === 2 && frameCount % 70 === 0) {
                            for(let i=0; i<8; i++) { let ang = (Math.PI*2/8)*i; enemyBullets.push({ x: boss.x+boss.w/2, y: boss.y+boss.h/2, vx: Math.cos(ang)*4, vy: Math.sin(ang)*4, bounce: 1 }); }
                        }
                    }
                    drawBoss(boss);
                }

                // Enemy Logic (Desain dikembalikan)
                enemies = enemies.filter(en => {
                    en.y += en.speed;
                    if (en.type === 'zigzag') { en.x += Math.sin(en.angle) * 4; en.angle += 0.1; }
                    if (en.type === 'shooter' && frameCount % 100 === 0) enemyBullets.push({ x: en.x + 20, y: en.y + 40, vx: 0, vy: 5 });
                    ctx.save(); ctx.translate(en.x+20, en.y+20); ctx.fillStyle='#1a1a1a'; 
                    ctx.strokeStyle= en.type === 'shooter' ? '#9d00ff' : (en.type === 'zigzag' ? '#ffff00' : '#ff3300'); ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(0,18); ctx.lineTo(-18,-12); ctx.lineTo(0,-6); ctx.lineTo(18,-12); ctx.closePath(); ctx.fill(); ctx.stroke(); ctx.restore();
                    if (en.y > canvas.height) { takeDamage(); return false; }
                    let hit = false;
                    bullets.forEach((b, bi) => { if (b.x > en.x && b.x < en.x+en.w && b.y < en.y+en.h && b.y > en.y) { hit = true; score += 20; updateUI(); createExplosion(en.x+20, en.y+20, '#ff3300', 10); bullets.splice(bi, 1); }});
                    return !hit;
                });

                // Enemy Bullets
                enemyBullets = enemyBullets.filter(eb => {
                    eb.x += eb.vx; eb.y += eb.vy;
                    if (eb.bounce && (eb.x < 0 || eb.x > canvas.width)) { eb.vx *= -1; eb.bounce--; }
                    ctx.fillStyle = eb.bounce ? '#9d00ff' : '#ffaa00'; ctx.beginPath(); ctx.arc(eb.x, eb.y, eb.bounce ? 5 : 3, 0, Math.PI*2); ctx.fill();
                    if (eb.x > player.x && eb.x < player.x+player.w && eb.y > player.y && eb.y < player.y+player.h) { takeDamage(); return false; }
                    return eb.y < canvas.height && eb.y > -50;
                });

                // Powerups
                powerUps = powerUps.filter(p => { 
                    p.y += 2.5; ctx.save(); ctx.translate(p.x+15, p.y+15);
                    let col = p.type === 'laser' ? '#ff3366' : '#00d2ff';
                    ctx.shadowBlur = 10; ctx.shadowColor = col; ctx.fillStyle = col;
                    ctx.beginPath(); ctx.arc(0, 0, 10, 0, Math.PI*2); ctx.fill();
                    ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.strokeRect(-6, -6, 12, 12);
                    ctx.restore();
                    if (p.x < player.x+player.w && p.x+30 > player.x && p.y < player.y+player.h && p.y+30 > player.y) {
                        if (p.type === 'laser') player.laserTimer = 400; else { player.shieldActive = true; player.shieldTimer = 600; }
                        score += 50; updateUI(); return false;
                    }
                    return p.y < canvas.height;
                });

                // Particles
                particles = particles.filter(p => { p.x += p.vx; p.y += p.vy; p.life -= 0.03; ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size); return p.life > 0; });

                // Player (Kembali ke Segitiga Ikonik)
                ctx.save(); ctx.translate(player.x+22, player.y+24);
                if (player.shieldActive) { ctx.strokeStyle = '#00d2ff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(0, 0, 42, 0, Math.PI*2); ctx.stroke(); }
                ctx.fillStyle='#1f2d3d'; ctx.strokeStyle='#00ffcc'; ctx.lineWidth = 2;
                ctx.beginPath(); ctx.moveTo(0,-24); ctx.lineTo(-22,20); ctx.lineTo(0,10); ctx.lineTo(22,20); ctx.closePath(); ctx.fill(); ctx.stroke();
                ctx.fillStyle='#00ffcc'; ctx.fillRect(-2,-6,4,12); ctx.restore();

                if (flashTimer > 0) { ctx.fillStyle = `rgba(255, 0, 0, ${flashTimer * 0.05})`; ctx.fillRect(0, 0, canvas.width, canvas.height); flashTimer--; }
            } 
            else if (gameState === 'GAMEOVER') {
                ctx.fillStyle = "rgba(0,0,0,0.8)"; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = "#fff"; ctx.textAlign = "center"; ctx.font = "32px 'Share Tech'"; ctx.fillText("MISSION FAILED", canvas.width/2, 320);
                drawButton(restartBtn, "RETRY");
            }
            ctx.restore(); requestAnimationFrame(gameLoop);
        }

        function drawButton(btn, text) {
            ctx.save(); const scale = btn.isHovered ? 1.05 : 1.0; const w = btn.w * scale, h = btn.h * scale;
            const x = btn.x - (w - btn.w) / 2, y = btn.y - (h - btn.h) / 2;
            ctx.fillStyle = btn.isHovered ? "#00ffcc" : "transparent"; ctx.strokeStyle = "#00ffcc"; ctx.lineWidth = 2;
            ctx.fillRect(x, y, w, h); ctx.strokeRect(x, y, w, h);
            ctx.fillStyle = btn.isHovered ? "#000" : "#00ffcc"; ctx.textAlign = "center"; ctx.font = "20px 'Share Tech'";
            ctx.fillText(text, canvas.width / 2, y + h / 2 + 8); ctx.restore();
        }

        initBackground(); gameLoop();
    </script>
</body>
</html>